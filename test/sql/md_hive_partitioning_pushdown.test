# name: hive_partioning_pushdown.test
# description: confirm that hive-specific filter pushdown now works in MD

require parquet

# Confirm
statement ok
COPY (SELECT i::VARCHAR as a, (i*10)::VARCHAR as b, (i*100)::VARCHAR as c from range(0,10) tbl(i)) TO '__TEST_DIR__/hive_pushdown_bug' (FORMAT PARQUET, PARTITION_BY c);

# Check that hive specific filters are pushed down into the explain plan regardless of format type
query II
explain SELECT * FROM parquet_scan('__TEST_DIR__/hive_pushdown_bug/*/*.parquet', HIVE_PARTITIONING=1, HIVE_TYPES_AUTOCAST=1) where c=500;
----
physical_plan	<REGEX>:.*PARQUET_SCAN.*Filters:.*c[ ]*=[ ]*500.*

query II
explain SELECT * FROM parquet_scan('__TEST_DIR__/hive_pushdown_bug/*/*.parquet', HIVE_PARTITIONING=1, HIVE_TYPES_AUTOCAST=1) where c=500 and b=20;
----
physical_plan	<REGEX>:.*PARQUET_SCAN.*Filters:.*c[ ]*=[ ]*500.*

# File Filters show up in read csv auto for hive partitioned csv files. 
statement ok
COPY (SELECT i::VARCHAR as a, (i*10)::VARCHAR as b, (i*100)::VARCHAR as c from range(0,10) tbl(i)) TO '__TEST_DIR__/hive_pushdown_bug_csv' (FORMAT CSV, PARTITION_BY c);

query II
explain SELECT * FROM read_csv_auto('__TEST_DIR__/hive_pushdown_bug_csv/*/*.csv', HIVE_PARTITIONING=1, HIVE_TYPES_AUTOCAST=1, names=['a','b','c']) where c=500;
----
physical_plan	<REGEX>:.*READ_CSV_AUTO.*Filters:.*c[ ]*=[ ]*500.*
