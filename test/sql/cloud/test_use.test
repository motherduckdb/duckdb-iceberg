# name: test/sql/cloud/test_use.test
# description: test use
# group: [cloud]

# require-env ICEBERG_AWS_REMOTE_AVAILABLE
#
# require-env AWS_ACCESS_KEY_ID
#
# require-env AWS_SECRET_ACCESS_KEY

require avro

require parquet

require iceberg

require httpfs

require aws

statement ok
CREATE SECRET glue_secret (
    TYPE S3,
    PROVIDER credential_chain,
    CHAIN 'sts',
    ASSUME_ROLE_ARN 'arn:aws:iam::840140254803:role/pyiceberg-etl-role',
    REGION 'us-east-1'
);

statement ok
attach '840140254803:s3tablescatalog/pyiceberg-blog-bucket' as glue_lake (
    TYPE ICEBERG,
    ENDPOINT_TYPE 'GLUE'
);

set ignore_error_messages

statement ok
use glue_lake.myblognamespace;

statement ok
use glue_lake;

statement error
select * from some_table;
----
<REGEX>:.*some_table.*does not exist.*

statement ok
use glue_secret;

statement error
select * from some_table
----
<REGEX>:.*some_table.*does not exist.*

mode output_result

# even after showing all tables. use statement needs catalog + schema.
statement ok
show all tables;

statement ok
use glue_lake;